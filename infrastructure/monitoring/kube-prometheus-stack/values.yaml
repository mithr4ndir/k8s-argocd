kube-prometheus-stack:
  # Prometheus configuration
  prometheus:
    prometheusSpec:
      retention: 15d
      additionalScrapeConfigs:
        - job_name: 'proxmox'
          metrics_path: /pve
          params:
            module: [default]
            cluster: ['1']
            node: ['1']
            target: ['localhost']
          static_configs:
            - targets:
              - '192.168.1.10:9221'
              - '192.168.1.11:9221'
        - job_name: 'vm-node-exporter'
          static_configs:
            - targets:
              - '192.168.1.88:9100'   # cmd_center1
              - '192.168.1.90:9100'   # k8cluster1
              - '192.168.1.89:9100'   # k8cluster2
              - '192.168.1.91:9100'   # k8cluster3
              - '192.168.1.92:9100'   # nginx1
              - '192.168.1.93:9100'   # nginx2
              - '192.168.1.121:9100'  # grafana
              - '192.168.1.167:9100'  # elastic
              - '192.168.1.122:9100'  # timescaledb
              - '192.168.1.150:9100'  # npm
              - '192.168.1.10:9100'   # pve
              - '192.168.1.11:9100'   # pve2
          relabel_configs:
            - source_labels: [__address__]
              regex: '(.*):\d+'
              target_label: instance
      storageSpec:
        volumeClaimTemplate:
          spec:
            storageClassName: k8s-nfs
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 50Gi
      externalLabels:
        cluster: quasarlab-k8s
      # Resource limits
      resources:
        requests:
          memory: 400Mi
          cpu: 200m
        limits:
          memory: 2Gi
          cpu: 1000m

  # Disable Grafana - using external Grafana VM at 192.168.1.121
  grafana:
    enabled: false

  # Alertmanager configuration
  alertmanager:
    enabled: true
    alertmanagerSpec:
      storage:
        volumeClaimTemplate:
          spec:
            storageClassName: k8s-nfs
            accessModes: ["ReadWriteOnce"]
            resources:
              requests:
                storage: 5Gi
      resources:
        requests:
          memory: 50Mi
          cpu: 10m
        limits:
          memory: 100Mi
          cpu: 100m

  # Node exporter disabled - already deployed via Ansible on k8s nodes
  nodeExporter:
    enabled: false

  # Kube state metrics for Kubernetes object metrics
  kubeStateMetrics:
    enabled: true

  # Scrape kubelet metrics
  kubelet:
    enabled: true

  # Scrape kube-proxy metrics
  kubeProxy:
    enabled: true

  # Prometheus Operator
  prometheusOperator:
    enabled: true
    resources:
      requests:
        memory: 100Mi
        cpu: 50m
      limits:
        memory: 200Mi
        cpu: 200m
